<!DOCTYPE html>
<html>
<script type="text/javascript" src="urlParser.js"></script>
<script type="text/javascript" src="babylon.1.11.js"></script>
<style>

	html, body {
		background-color: #000000;
	}

	html, body, div, canvas {
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
		overflow: hidden;
	}

</style>
<body style="-webkit-app-region: drag">
<div id="rootDiv">
  <canvas id="renderCanvas"></canvas>
</div>
</body>
</html>

<script type="text/javascript">

	var net = require('net');
	var gui = require('nw.gui');
	var Game = require('./Game.js');

	var win = gui.Window.get();
	var config = URL.parse(window.location).params;
	var game = new Game(BABYLON, window, document);

	document.addEventListener('keydown', function(e){
		if (e.keyCode == 13 && e.metaKey)
			win.toggleFullscreen();
	});


	var client = new net.Socket();
	client.connect(config.port, config.host,
		function() {
			client.write('msz\n');
			client.write('sst\n');
			client.write('sgt\n');
	});

	client.on('data', function(data) {
		console.log(data.toString());

		var responses = data.toString().split('\n');

		for (var i in responses) {
			var args = responses[i].split(' ');

			if (args[0] == 'msz') {
				game.updateMap(args[1], args[2]);
				game.run();
			}
		}
	});

	client.on('end', function() {
		console.log('Client disconnected');
	});

</script>
</html>