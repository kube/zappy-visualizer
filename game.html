<!DOCTYPE html>
<html>
<script type="text/javascript" src="urlParser.js"></script>
<script type="text/javascript" src="client.js"></script>
<script type="text/javascript" src="babylon.1.11.js"></script>
<style>

	html, body {
		background-color: #000000;
	}

	html, body, div, canvas {
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
		overflow: hidden;
	}

</style>
<body style="-webkit-app-region: drag">
<div id="rootDiv">
  <canvas id="renderCanvas"></canvas>
</div>
</body>
</html>

<script type="text/javascript">

	var Game = require('./Game.js');


	var gui = require('nw.gui');
	var win = gui.Window.get();

	var canvas = document.getElementById("renderCanvas");
	var engine = new BABYLON.Engine(canvas, true);
	var scene = new BABYLON.Scene(engine);

	window.onresize = function(){
		engine.resize();
	}



	var game = new Game(42, 42);



	var cameras = []

	cameras.push(new BABYLON.ArcRotateCamera("Camera", 1, 0.8, 10, new BABYLON.Vector3(0, 0, 0), scene));

	// cameras.push(new BABYLON.AnaglyphFreeCamera("AnaglyphCamera", new BABYLON.Vector3(0, 2, 4), 0.5, scene));

	cameras.push(new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 1, -15), scene));


	document.addEventListener('keydown', function(e){

		console.log(e);

		if (e.keyCode == 13 && e.metaKey)
			win.toggleFullscreen();
		else if (e.keyCode == 32) {

			scene.activeCamera = cameras[(cameras.indexOf(scene.activeCamera) + 1) % cameras.length];
			scene.activeCamera.attachControl(canvas);
		}
	});





	var light = new BABYLON.DirectionalLight("dir01", new BABYLON.Vector3(-1, -2, -1), scene);


	canvas.addEventListener('click', function(e) {
		var pick = scene.pick(e.x, e.y);

		console.log(pick.pickedMesh);

		pick.pickedMesh.position.y += 0.5;

		return false;
	});



	for (var i in game.map.blocks) {

		var block = game.map.blocks[i];

		var x = block.x - (game.width / 2);
		var y = block.y - (game.height / 2);

		var box = BABYLON.Mesh.CreateBox("Box", 0.9, scene);
		box.position = new BABYLON.Vector3(x, 0, y);
		box.scaling.y = 0.2;
	}




	light.position = new BABYLON.Vector3(20, 40, 20);



	scene.gravity = new BABYLON.Vector3(0, -9.81, 0);

	scene.activeCamera.attachControl(canvas);

	engine.runRenderLoop(function () {
		scene.render();
	});

</script>
</html>