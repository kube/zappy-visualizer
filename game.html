<!DOCTYPE html>
<html>
<script type="text/javascript" src="urlParser.js"></script>
<script type="text/javascript" src="babylon.1.11.js"></script>
<style>

	html, body {
		background-color: #000000;
		user-select: none;
	}

	html, body, div, canvas {
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
		overflow: hidden;
	}

</style>
<link rel="stylesheet" href="./style.css">
<body>
	<div id="rootDiv">
		<div id="dragger" style="-webkit-app-region: drag">
			<a id="btn_hide" style="-webkit-app-region: no-drag"
				onclick="javascript:win.minimize();"></a>
			<a id="btn_resize" style="-webkit-app-region: no-drag"
				onclick="javascript:win.toggleFullscreen();"></a>
			<a id="btn_close" style="-webkit-app-region: no-drag"
				onclick="javascript:gui.App.quit();"></a>
		</div>
		<canvas id="renderCanvas"></canvas>
	</div>
</body>
</html>

<script type="text/javascript">

	var net = require('net');
	var gui = require('nw.gui');
	var Game = require('./Game.js');

	var win = gui.Window.get();
	var config = URL.parse(window.location).params;
	var game = new Game(BABYLON, window, document);

	var client = new net.Socket();
	client.connect(config.port, config.host,
		function() {
			client.write('msz\n');
			client.write('sst\n');
			client.write('sgt\n');
	});

	client.on('data', function(data) {
		console.log(data.toString());

		var responses = data.toString().split('\n');

		for (var i in responses) {
			var args = responses[i].split(' ');

			if (args[0] == 'msz') {
				game.updateMap(args[1], args[2]);
				game.run();
			}
		}
	});

	client.on('end', function() {
		console.log('Client disconnected');
	});

</script>
</html>